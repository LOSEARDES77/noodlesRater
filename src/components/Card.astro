---
import { Image } from "astro:assets";

const { id, name, ratings = 0, img } = Astro.props;
// parse rating as number
const ratingsNum = Number(ratings);
const uniqueRatingName = `rating-${id}`;
---

<div
  class="card bg-white shadow-md rounded-lg p-4 w-80 text-black hover:scale-105 transition-transform duration-300 ease-in-out"
  transition:name={`card-${id}`}
  data-rating={ratings}
  data-name={name.toLowerCase()}
>
  <Image
    id={`img-${id}`}
    width={200}
    height={400}
    src={img || "https://picsum.photos/400/200"}
    alt={name || "Noodle"}
    class="rounded-t-lg w-full h-40 object-cover mb-4 cursor-zoom-in"
    loading="lazy"
    placeholder="blur"
    transition:name={`image-${id}`}
  />
  <h2 transition:name={`name-${id}`} class="text-xl font-bold mb-2">{name}</h2>
  <div>
    <div class="rating rating-lg rating-half" transition:name={`rater-${id}`}>
      <input
        type="radio"
        name={uniqueRatingName}
        class="rating-hidden"
        checked={ratingsNum === 0}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-1 bg-orange-500"
        aria-label="0.5 star"
        checked={ratingsNum === 1}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-2 bg-orange-500"
        aria-label="1 star"
        checked={ratingsNum === 2}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-1 bg-orange-500"
        aria-label="1.5 star"
        checked={ratingsNum === 3}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-2 bg-orange-500"
        aria-label="2 star"
        checked={ratingsNum === 4}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-1 bg-orange-500"
        aria-label="2.5 star"
        checked={ratingsNum === 5}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-2 bg-orange-500"
        aria-label="3 star"
        checked={ratingsNum === 6}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-1 bg-orange-500"
        aria-label="3.5 star"
        checked={ratingsNum === 7}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-2 bg-orange-500"
        aria-label="4 star"
        checked={ratingsNum === 8}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-1 bg-orange-500"
        aria-label="4.5 star"
        checked={ratingsNum === 9}
        disabled
      />
      <input
        type="radio"
        name={uniqueRatingName}
        class="mask mask-star-2 mask-half-2 bg-orange-500"
        aria-label="5 star"
        checked={ratingsNum === 10}
        disabled
      />
    </div>
    <p class="mt-2 text-sm text-gray-600" transition:name={`rater-text-${id}`}>
      Puntuación: {ratings}/10
    </p>
  </div>

  <a
    href={`/${id}`}
    class="flex justify-center"
    transition:name=`moreInfo-${id}`
    ><button class="btn btn-primary mt-4">Mas Información</button></a
  >
</div>

<div
  id={`modal-${id}`}
  class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 items-center justify-center"
>
  <img
    src={img || "https://picsum.photos/400/200"}
    alt={name}
    class="max-w-full max-h-full rounded-lg"
  />
  <button id={`close-${id}`} class="absolute top-4 right-4 text-white text-3xl"
    >&times;</button
  >
</div>

<script type="module">
  const imgEl = document.getElementById(`img-${id}`);
  const modalEl = document.getElementById(`modal-${id}`);
  const closeBtn = document.getElementById(`close-${id}`);
  imgEl.addEventListener("dblclick", () => {
    modalEl.classList.remove("hidden");
    modalEl.classList.add("flex");
  });
  closeBtn.addEventListener("click", () => {
    modalEl.classList.add("hidden");
    modalEl.classList.remove("flex");
  });
</script>
